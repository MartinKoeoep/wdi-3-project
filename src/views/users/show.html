<h1 class="title is-1">{{ user.username }}'s profile</h1>
<div class="columns is-multiline">
  <div class="column is-one-quarter">
    <figure class="image is-square">
      <img src="{{ user.avatar }}" alt="{{ user.username }}">
    </figure>
    <a ui-sref="usersEdit({ id: user._id })" class="button" ng-if="isAuthenticated() && isOwner">Edit Profile</a>
    <a ui-sref="usersDelete({ id: user._id })" class="button is-danger" ng-if="isAuthenticated() && isOwner">Delete User</a>
    <a class="button is-success" ng-click="createMessage(user, currentUser)">Message User</a>
  </div>
  <div class="column is-one-quarter">
    <ul>
      <li>Rating: {{ '⭐️'.repeat(user.avgRating)}}</li>
      <li>Number of trades: {{ user.numberOfTrades }}</li>
    </ul>
  </div>
  <div class="column is-fullwidth">
    <h1 class="title is-1">Offers received</h1>
    <table class="table is-hoverable is-fullwidth">
      <thead>
        <th>User</th>
        <th>User Rating</th>
        <th>Wants</th>
        <th>Offers</th>
        <th>Message</th>
        <th>Status</th>
      </thead>
      <tbody>
        <tr ng-repeat="request in user.incomingRequests">
          <td>{{ request.offeredRecord.owner.username }}</td>
          <td>{{ request.offeredRecord.owner.avgRating }}</td>
          <td>{{ request.wantedRecord.title }}</td>
          <td>{{ request.offeredRecord.title }}</td>
          <td>{{ request.message }}</td>
          <td>{{ request.status }}</td>
          <td><a class="button is-success" ng-if="request.stage[0] < 1" ng-click="acceptOffer(request)">Accept</a></td>
          <td><a class="button is-danger" ng-if="request.stage[0] < 1" ng-click="declineOffer(request)">Decline</a></td>
          <td><a class="button is-danger" ng-if="request.stage[0] === 1" ng-click="recordsAction(user.username, request, 'records sent', 0)">Record(s) sent</a></td>
          <td><a class="button is-danger" ng-if="request.stage[1] === 2" ng-click="recordsAction(user.username, request, 'records received', 1)">Record(s) received</a></td>
          <td><a class="button is-danger" ng-if="request.stage[1] === 3 && request.stage[0] === 3" ng-click="swapRecords(request.wantedRecord._id, request.offeredRecord._id, request._id)">Swap records</a></td>
        </tr>
      </tbody>
    </table>

    <h1 class="title is-1">Offers made</h1>
    <table class="table is-hoverable is-fullwidth">
      <thead>
        <th>User</th>
        <th>User Rating</th>
        <th>Wants</th>
        <th>Offers</th>
        <th>Message</th>
        <th>Status</th>
      </thead>
      <!-- {{user.outgoingRequests[0].wantedRecord}}
      <hr>
      {{user.outgoingRequests[0].offeredRecord[1]}}
      <hr>
      {{user.outgoingRequests[0].offeredRecord[2]}}
      <hr>
      {{user.outgoingRequests[1]}} -->
      <tbody>
            <div ng-repeat="offeredRecords in user.outgoingRequests">
              <div ng-repeat="records in offeredRecords">
                <div ng-repeat="record in records">
                    {{ record.artist }}
                </div>

              </div>

            </div>
            <!-- <td><span ng-repeat="record in user.outgoingRequests[0].offeredRecord[0]">{{ record }}</span></td> -->


          <!-- <td>{{ request.wantedRecord.owner.avgRating }}</td>
          <td>{{ request.wantedRecord.title }}</td>
          <td>{{ request.offeredRecord.title }}</td>
          <td>{{ request.message }}</td>
          <td>{{ request.status }}</td> -->
          <td><a class="button is-success" ng-if="request.stage[1] < 1" ui-sref="requestsEdit({ id: request._id })">Edit</a></td>
          <td><a class="button is-danger" ng-click="deleteOffer(request)">Delete</a></td>
          <td><a class="button is-danger" ng-if="request.stage[1] === 1" ng-click="recordsAction(user.username, request, 'records sent', 1)">Record(s) sent</a></td>
          <td><a class="button is-danger" ng-if="request.stage[0] === 2" ng-click="recordsAction(user.username, request, 'records received', 0)">Record(s) received</a></td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="column is-one-sixth">

  </div>
  <div class="column is-two-thirds">
    <h3 class="title is-3">User comments</h3>
    <div class="card" ng-repeat="comment in user.comments">
      <div class="card-content">
        <div class="content">
          <h5 class="title is-5">{{ comment.content }}</h5>
          <h6 class="title is-6">Rated: {{ '⭐️'.repeat(comment.rating) }}</h6>
          <h6 class="title is-6">By: {{ comment.author.username }}</h6>
        </div>
        <button class="button is-danger commentDelete" ng-click="deleteComment(comment)" ng-if="isAuthenticated()">DELETE</button>
      </div>
    </div>
    <div class="column is-three-quarters" ng-if="isAuthenticated()">
      <form ng-submit="createComment()">
        <div class="field">
          <label class="label" for="content">Comment</label>
          <textarea class="input" id="content" name="content" placeholder="Content" ng-model="commentData.content">
          </textarea>
        </div>
        <div class="field">
          <div class="control">
            <label class="label">Rating</label>
            <div class="select">
              <select ng-model="commentData.rating">
                <option value="">Please select</option>
                <option value="1">⭐️</option>
                <option value="2">⭐️⭐️</option>
                <option value="3">⭐️⭐️⭐️</option>
                <option value="4">⭐️⭐️⭐️⭐️</option>
                <option value="5">⭐️⭐️⭐️⭐️⭐️</option>
              </select>
            </div>
          </div>
        </div>
        <button>Submit Comment</button>
      </form>
    </div>
  </div>
  <div class="column is-one-sixth">

  </div>

</div>
